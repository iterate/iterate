# this file is generated by pullfrog.ts, do not edit it manually

name: Pullfrog
run-name: ${{ inputs.name || github.workflow }}
on:
  workflow_dispatch:
    inputs:
      prompt:
        type: string
        description: Agent prompt
      name:
        type: string
        description: Run name
permissions:
  id-token: write
  contents: write
  pull-requests: write
  issues: write
  actions: read
  checks: read
jobs:
  pullfrog:
    runs-on: ubuntu-24.04
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          ref: ${{ github.event.pull_request.head.sha || github.sha }}
          fetch-depth: 1
      - name: Setup pnpm
        uses: pnpm/action-setup@v4
      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: 24
          cache: pnpm
      - name: Install dependencies
        run: pnpm install
      - name: Install Doppler CLI
        run: |-
          for i in 1 2 3; do curl -sfLS https://cli.doppler.com/install.sh | sh -s -- --no-package-manager && break; echo "Attempt $i failed, retrying in 5s..."; sleep 5; done
          doppler --version || { echo 'Failed to install Doppler CLI after 3 attempts'; exit 1; }
      - name: Setup Doppler
        run: doppler setup --config dev --project os
        env:
          DOPPLER_TOKEN: ${{ secrets.DOPPLER_TOKEN }}
      - name: Set ANTHROPIC_API_KEY env var
        run: echo "ANTHROPIC_API_KEY=$(doppler secrets get ANTHROPIC_API_KEY --plain)" >> $GITHUB_OUTPUT
      - name: Set OPENAI_API_KEY env var
        run: echo "OPENAI_API_KEY=$(doppler secrets get OPENAI_API_KEY --plain)" >> $GITHUB_OUTPUT
      - name: Run agent
        uses: pullfrog/pullfrog@v0
        with:
          prompt: ${{ inputs.prompt }}