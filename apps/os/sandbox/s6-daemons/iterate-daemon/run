#!/bin/sh
exec 2>&1

# Source env vars written by bootstrap (API keys, etc.)
[ -f ~/.iterate/.env ] && set -a && . ~/.iterate/.env && set +a

SCRIPT_DIR="$(cd "$(dirname "$0")" && pwd)"
PORT=$(node -p "require('$SCRIPT_DIR/metadata.json').port")

cd "$ITERATE_REPO/apps/daemon"
pnpm db:migrate
exec env HOSTNAME=0.0.0.0 PORT="$PORT" tsx server.ts
