services:
  egress-proxy:
    build:
      context: .
      dockerfile: docker/egress.Dockerfile
    environment:
      EGRESS_MITM_PORT: "18080"
      EGRESS_VIEWER_PORT: "18081"
      MITM_DIR: /data/mitm
      EGRESS_LOG_PATH: /tmp/egress-proxy.log
    volumes:
      - fly-test-mitm-data:/data/mitm

  sandbox-ui:
    build:
      context: .
      dockerfile: docker/sandbox.Dockerfile
    environment:
      SANDBOX_PORT: "8080"
      EGRESS_PROXY_HOST: "egress-proxy"
      EGRESS_MITM_PORT: "18080"
      EGRESS_VIEWER_PORT: "18081"
      DEFAULT_TARGET_URL: "${TARGET_URL:-https://example.com/}"
    depends_on:
      - egress-proxy

volumes:
  fly-test-mitm-data:
